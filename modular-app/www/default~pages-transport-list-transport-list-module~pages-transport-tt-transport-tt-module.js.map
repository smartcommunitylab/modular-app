{"version":3,"sources":["webpack:///./src/app/module-trasporti/services/transport.service.ts"],"names":[],"mappings":"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","file":"default~pages-transport-list-transport-list-module~pages-transport-tt-transport-tt-module.js","sourcesContent":["import { Injectable } from '@angular/core';\nimport { ConfigService } from './config.service';\nimport { HttpClient } from '@angular/common/http';\nimport { DbService } from './db.service';\nimport { resolve } from 'dns';\nimport { reject } from 'q';\nimport { DatePipe } from '@angular/common';\nimport { Platform } from '@ionic/angular';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TransportService {\n  calendarCache = {};\n  stopCache = {};\n  ttMapData = {};\n  ttStopData = {};\n  constructor(private config: ConfigService, private platform: Platform, private datePipe: DatePipe,private dbService: DbService, private http: HttpClient) { }\n\n  getTTData(ref, agencyId?, groupId?, routeId?): Promise<any> {\n    return this.config.getTtJsonConfig().then(res => {\n      if (!!ref) {\n        res = res.elements[ref];\n      }\n      if (!!agencyId) {\n        for (var i = 0; i < res.elements.length; i++) {\n          if (res.elements[i].agencyId == agencyId) {\n            res = res.elements[i];\n            break;\n          }\n        }\n      }\n\n      var searchRec = function (res, groupIds, idx) {\n        if (idx >= groupIds.length) return res;\n        for (var i = 0; i < res.groups.length; i++) {\n          if (res.groups[i].label == groupIds[idx]) {\n            res = searchRec(res.groups[i], groupIds, idx + 1);\n            break;\n          }\n        }\n        return Promise.resolve(res);\n      };\n\n      if (!!groupId) {\n        var groupIds = groupId.split(',');\n        res = searchRec(res, groupIds, 0);\n      }\n      if (!!routeId) {\n        for (var i = 0; i < res.routes.length; i++) {\n          if (res.routes[i].routeId == routeId) {\n            res = res.routes[i];\n            break;\n          }\n        }\n      }\n      return Promise.resolve(res);\n    });\n  }\n  \n  flattenElement = function (e, res, ref, agencyId) {\n    var localAgency = agencyId;\n    if (e.agencyId != null) localAgency = e.agencyId;\n    if (e.groups != null) {\n      for (var j = 0; j < e.groups.length; j++) {\n        res.push({\n          ref: ref,\n          agencyId: localAgency,\n          group: e.groups[j],\n          color: e.groups[j].color,\n          label: e.groups[j].label,\n          title: e.groups[j].title ? e.groups[j].title : e.groups[j].label,\n          gridCode: e.groups[j].gridCode\n        });\n      }\n    }\n    if (e.routes != null) {\n      for (var j = 0; j < e.routes.length; j++) {\n        res.push({\n          ref: ref,\n          agencyId: localAgency,\n          route: e.routes[j],\n          color: e.color,\n          label: e.routes[j].label ? e.routes[j].label : e.label,\n          title: e.routes[j].title ? e.routes[j].title : e.title\n        });\n      }\n    }\n  }\n  flattenData(data, ref, agencyId) {\n    var res = [];\n    if (data.elements) {\n      for (var i = 0; i < data.elements.length; i++) {\n        var e = data.elements[i];\n        this.flattenElement(e, res, ref, agencyId);\n      }\n    } else {\n      this.flattenElement(data, res, ref, agencyId);\n    }\n    return res;\n  }\n\n\n\n  getStopsData(agencies) {\n    var res = [];\n    var that = this;\n    agencies.forEach(function (a) {\n      var local = localStorage[that.config.getAppId() + \"_stops_\" + a];\n      if (local) {\n        local = JSON.parse(local);\n        if (local && local.length > 0) {\n          local.forEach(function (s) {\n            s.agencyId = a;\n            res.push(s);\n          });\n        }\n      }\n    });\n    return res;\n  };\n\n  getStop(agencyId, stopId) {\n    var that = this;\n    var key = agencyId + '_' + stopId;\n    if (!this.stopCache[key]) {\n      var stops = this.getStopsData([agencyId]);\n      if (stops) {\n        stops.forEach(function (s) {\n          that.stopCache[agencyId + '_' + s.id] = s;\n        });\n      }\n    }\n\n    return this.stopCache[key];\n  }\n\n  toTrimmedList(str) {\n    if (!str) return [];\n    try {\n      var arr = str.split(',');\n      var res = [];\n      arr.forEach(function (e) {\n        res.push(e.trim());\n      });\n      return res;\n    } catch (e) {\n      console.error('ERROR PARSING ARRAY: ' + e);\n      return [];\n    }\n  }\n\n  getDelays(agency, route, date) {\n    var that=this;\n    var deferred = new Promise((resolve, reject) => {\n      var d = new Date(date);\n      d.setHours(0);\n      d.setMinutes(0);\n      d.setSeconds(0);\n      d.setMilliseconds(0);\n      var from = d.getTime();\n      d.setHours(23);\n      d.setMinutes(59);\n      var to = d.getTime();\n      route = encodeURIComponent(route);\n      that.http.get(that.config.getServerURL() + '/gettransitdelays/' + agency + '/' + route + '/' + from + '/' + to).toPromise()\n        .then(function (data: any) {\n          if (data && data.delays) resolve(data.delays[0]);\n        }).catch(function (err) {\n          reject(err);\n        });\n\n    })\n    return deferred;\n  }\n\n  toWheelChairBoarding(agencyId, stops) {\n    var res = [];\n    var that=this;\n    stops.forEach(function (s) {\n      var stop = that.getStop(agencyId, s);\n      if (!!stop) res.push(stop.wheelChairBoarding);\n      else res.push(0);\n    });\n    return res;\n  }\n\n  /**\n   * transform compressed string to matrix of times. string is a sequence of all trip times separated with '|'. Each time (if presented) has 4 chars.\n   */\n  uncompressTime(str, rowsCount) {\n    if (!str) return [];\n    var res = [];\n    var column = [];\n    var counter = 0;\n    for (var i = 0; i < str.length; i++) {\n      var c = str.charAt(i);\n      if (c == ' ') continue;\n      if (c == '|') column.push(\"\");\n      else {\n        column.push(str.substr(i, 2) + \":\" + str.substr(i + 2, 2));\n        i += 3;\n      }\n      counter++;\n      if (counter == rowsCount) {\n        res.push(column);\n        column = [];\n        counter = 0;\n      }\n    }\n    return res;\n  }\n\n  /**\n   * Read TT from DB: given a agency/route/date, get a hash and then read stopIds, name,s tripIds, and times from DB.\n   * Due to the problem with the plugin (does not escape JSON strings), it is necessary to do 5 DB calls in a row.\n   * Parallel calls seems to end up in DB lock sometimes.\n   */\n  dataFromHash(agency, route, date, resolve, reject) {\n    var that = this;\n    var cal = this.calendarCache[agency][route];\n    var dateStr = this.datePipe.transform(date, 'yyyyMMdd');\n    var hash = route + '_' + cal.mapping[cal.entries[dateStr]];\n    var errCB = function (err) {\n      reject(err);\n    };\n    var result = {\n      stops: [],\n      tripIds: [],\n      times: [],\n      stopsId: [],\n      routeIds: [],\n      wheelChairBoarding: [],\n      delays: []\n    };\n    this.dbService.doQuery(\"SELECT * FROM route WHERE agencyID = '\" + agency + \"' AND linehash = '\" + hash + \"'\", [])\n      .then(function (data) {\n        if (!data || !data[0] || !data[0].stopsNames) {\n          // notify(result);\n          resolve(result);\n          return;\n        }\n        result.stops = that.toTrimmedList(data[0].stopsNames);\n        result.stopsId = that.toTrimmedList(data[0].stopsIDs);\n        result.tripIds = that.toTrimmedList(data[0].tripIds);\n        result.wheelChairBoarding = that.toWheelChairBoarding(agency, that.toTrimmedList(data[0].stopsIDs));\n        result.times = that.uncompressTime(data[0].times, result.stops.length);\n        // deferred.notify(result);\n        that.getDelays(agency, route, date).then(function (delays:any) {\n          result.delays = delays;\n          resolve(result);\n        }, function () {\n          resolve(result);\n        });\n        //      DataManager.doQuery(\"SELECT stopsNames FROM route WHERE agencyID = '\"+agency+\"' AND linehash = '\"+hash+\"'\",[])\n        //      .then(function(data) {\n        //        result.stops = toTrimmedList(data);\n        //        DataManager.doQuery(\"SELECT tripIds FROM route WHERE agencyID = '\"+agency+\"' AND linehash = '\"+hash+\"'\",[])\n        //        .then(function(data) {\n        //          result.tripIds = toTrimmedList(data);\n        //          DataManager.doQuery(\"SELECT times FROM route WHERE agencyID = '\"+agency+\"' AND linehash = '\"+hash+\"'\",[])\n        //          .then(function(data) {\n        //            result.times = uncompressTime(data,result.stopIds.length);\n        //            getDelays(agency, route, date).then(function(delays){\n        //              result.delays = delays;\n        //              deferred.resolve(result);\n        //            }, function() {\n        //              deferred.resolve(result);\n        //            });\n        //          }, errCB);\n        //        }, errCB);\n        //      }, errCB);\n      }, errCB);\n  };\n\n  getNextTrips(agencyId, stopId, numberOfResults) {\n    var deferred = new Promise((resolve, reject) => {\n\n\n      numberOfResults = numberOfResults || 3;\n      this.http.get(this.config.getServerURL() + '/getlimitedtimetable/' + agencyId + '/' + stopId + '/' + numberOfResults).toPromise()\n        .then(function (data) {\n          resolve(data);\n        })\n        .catch(function (err) {\n          reject(err);\n        });\n    })\n    return deferred;\n  };\n\n  getStopData(ref, agencyId, stopId) {\n    var deferred = new Promise((resolve, reject) => {\n\n      var stop = null;\n      var stops = this.getStopsData([agencyId]);\n      if (stops) {\n        for (var i = 0; i < stops.length; i++) {\n          if (stops[i].id == stopId) {\n            stop = stops[i];\n            break;\n          }\n        }\n        if (stop) {\n          this.getNextTrips(stop.agencyId, stop.id, 5).then(function (data) {\n            var ttData = this.config.getTTData(ref);\n            var flatTTData = this.config.flattenData(ttData, ref);\n\n            //pass the right agencyid\n            //find the agencyId and call the right group\n            var flat = null;\n            if (flatTTData[0] && flatTTData[0].group && flatTTData[0].group.groups) {\n              for (var i = 0; i < flatTTData.length; i++) {\n                if (flatTTData[i] && flatTTData[i].group && flatTTData[i].group.groups && flatTTData[i].group.agencyId == stop.agencyId) {\n                  flat = flatTTData[i].group.groups;\n                  break;\n                }\n              }\n            } else {\n              flat = flatTTData;\n            }\n            flat.forEach(function (e) {\n              var list = [];\n              if (e.group) {\n                if (e.group.routes) list = list.concat(e.group.routes);\n                else if (e.group.route) list.push(e.group.route);\n              } else {\n                if (e.routes) list = list.concat(e.routes);\n                else if (e.route) list.push(e.route);\n              }\n              list.forEach(function (r) {\n                if (data[r.routeId] != null) {\n                  data[r.routeId].routeElement = e;\n                  data[r.routeId].routeObject = r;\n                  //                routes.push(data[r.routeId]);\n                } else if (data[r.routeSymId] != null) {\n                  data[r.routeSymId].routeElement = e;\n                  data[r.routeSymId].routeObject = r;\n                  //                routes.push(data[r.routeSymId]);\n                }\n              });\n            });\n            stop.data = data;\n            resolve(stop);\n          }, function (err) {\n            reject(err);\n          });\n        } else {\n          resolve(null);\n        }\n      } else {\n        resolve(null);\n      }\n    })\n\n    return deferred;\n  }\n\n\n  /**\n   * timetable for specified timestamp: converted to date start/end timestamps\n   */\n  getTT(agency:string, route:string, date) {\n    var that = this;\n    var deferred = new Promise((resolve, reject)=>{\n    if (! that.platform.is('mobileweb')){\n      // use cache of calendar hashes\n      if (that.calendarCache[agency] == null) {\n        that.calendarCache[agency] = {};\n      }\n      if (that.calendarCache[agency][route] == null) {\n        that.dbService.doQuery(\"SELECT calendar FROM calendar WHERE agencyID = '\" + agency + \"' AND route = '\" + route + \"'\", [])\n          .then(function (data:any) {\n            if (!data || data.length == 0) {\n              reject({});\n              return;\n            }\n            that.calendarCache[agency][route] = JSON.parse(data);\n            that.dataFromHash(agency, route, date, resolve, reject);\n          }, function (err) {\n            reject(err);\n          });\n      } else {\n        that.dataFromHash(agency, route, date, resolve, reject);\n      }\n    } else {\n      // use remote call for timetable\n      var d = new Date(date);\n      d.setHours(0);\n      d.setMinutes(0);\n      d.setSeconds(0);\n      d.setMilliseconds(0);\n      var from = d.getTime();\n      d.setHours(23);\n      d.setMinutes(59);\n      var to = d.getTime();\n      route = encodeURIComponent(route);\n      that.http.get(that.config.getServerURL() + '/gettransittimes/' + agency + '/' + route + '/' + from + '/' + to).toPromise()\n        .then(function (data:any) {\n          if (data.times) data.times = data.times[0];\n          if (data.tripIds) data.tripIds = data.tripIds[0];\n          if (data.delays) data.delays = data.delays[0];\n          data.wheelChairBoarding = that.toWheelChairBoarding(agency, data.stopsId);\n          // deferred.notify(data);\n          resolve(data);\n        })\n        .catch(function (err) {\n          reject(err);\n        });\n    }\n\n  })\n    return deferred;\n  }\n  /**\n   * Find a column that corresponds to the current time\n   */\n  locateTablePosition(data, time) {\n    if (!data) return;\n    time = this.datePipe.transform(time, 'HH:mm');\n    for (var i = 0; i < data.tripIds.length; i++) {\n      if (!data.times[i]) continue;\n      for (var j = 0; j < data.times[i].length; j++) {\n        if (!!data.times[i][j]) {\n          if (data.times[i][j].localeCompare(time) >= 0) {\n            return i;\n          }\n        }\n      }\n    }\n    return data.tripIds.length - 1;\n  }\n\n\n\n  /**\n   * Cache the data for the TT map set up\n   */\n  getTTMapData() {\n    return this.ttMapData;\n  }\n  setTTMapData(mapData) {\n    this.ttMapData = mapData;\n  }\n  /**\n   * Cache the data for the TT stop set up\n   */\n  getTTStopData() {\n    return this.ttStopData;\n  }\n  getTTStopDataAsync(ref, agencyId, stopId) {\n    return this.getStopData(ref, agencyId, stopId);\n  }\n  setTTStopData(stopData) {\n    this.ttStopData = stopData;\n  }\n}\n"],"sourceRoot":""}